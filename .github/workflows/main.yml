name: Sync to Hugging Face Space

on:
  push:
    branches: [main]
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  sync-to-hf:
    name: Build & Deploy to Hugging Face
    runs-on: ubuntu-latest
    env:
      HF_USER: adrian99           # <-- your HF username
      SPACE_NAME: Simplyyou       # <-- your Space name

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true               # include Git LFS-tracked model/assets

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Optional sanity check (requirements + gradio import)
        if: hashFiles('requirements.txt') != ''
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt || true
          python - << 'PY'
import importlib
try:
    importlib.import_module("gradio")
    print("âœ… Gradio import OK")
except Exception as e:
    print("âš ï¸ Gradio not installed or import failed:", e)
PY

      - name: Configure Git for push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git lfs install

      - name: Push current main to Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}   # create this in GitHub repo settings
        run: |
          if [ -z "$HF_TOKEN" ]; then
            echo "âŒ HF_TOKEN secret is missing"; exit 1
          fi
          SPACE_REMOTE="https://${HF_USER}:${HF_TOKEN}@huggingface.co/spaces/${HF_USER}/${SPACE_NAME}"
          # Push HEAD to Space main; --force keeps Space in sync with GitHub
          git push --force "$SPACE_REMOTE" HEAD:main
          echo "ðŸš€ Pushed to Space. Build will start automatically."

      # Optional: ping the Space status after a short delay (non-blocking)
      - name: Check Space status (optional)
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          sleep 5
          curl -s -H "Authorization: Bearer $HF_TOKEN" \
            "https://huggingface.co/api/spaces/${{ env.HF_USER }}/${{ env.SPACE_NAME }}" \
            | sed -E 's/\",\"/\",\\n\"/g' || true
